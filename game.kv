ScreenManager:
    MainScreen:
    Level1:
    Level2:
    Level3:
    Level4:
    Level5:

<MainScreen>:
    name: "main"
    on_enter: app.main_screen_on_enter()
    on_leave: app.main_screen_on_leave()
    canvas.before:
        Rectangle:
            size: self.size
            source: 'graphics/Main_menu_bg.jpg'
    RelativeLayout:
        id: lvls_imagebuttons
        LevelButton:
            text: "Level 1"
            on_press:
                root.manager.transition.direction = 'left'
                app.root.current="level1"
            pos_hint: {"center_x": .5, "center_y": .55}
        LevelButton:
            text: "Level 2"
            on_press:
                root.manager.transition.direction = 'left'
                app.root.current="level2"
            pos_hint: {"center_x": .5, "center_y": .45}
        LevelButton:
            text: "Level 3"
            on_press:
                root.manager.transition.direction = 'left'
                app.root.current="level3"
            pos_hint: {"center_x": .5, "center_y": .35}
        LevelButton:
            text: "Level 4"
            on_press:
                root.manager.transition.direction = 'left'
                app.root.current="level4"
            pos_hint: {"center_x": .5, "center_y": .25}
        LevelButton:
            text: "Level 5"
            on_press:
                root.manager.transition.direction = 'left'
                app.root.current="level5"
            pos_hint: {"center_x": .5, "center_y": .15}

<Level1>:
    name: "level1"
    on_pre_enter: app.screen_on_pre_enter(1)
    #on_pre_leave: app.screen_on_pre_leave(1)
    on_enter: app.screen_on_enter(1)
    on_leave: app.screen_on_leave(1)
    BoxLayout:
        orientation: "horizontal"
        RelativeLayout:
            size_hint: app.side_bar_width, 1
            PauseButton:
                id: pause_button_lvl1
                on_press: app.pause_game(1)
            RemainingLifePercent
                id: remaining_life_percent_lvl1
            BoxLayout:
                size_hint: 1, 0.05
                pos_hint: {"x": 0.0, "y": .36}
                Label:
                    size_hint: 0.35, 1
                    canvas:
                        Rectangle:
                            pos: self.pos
                            size: self.size
                            source: "graphics/entities/star_small.png"
                NumCollectedStars:
                    id: num_stars_collected_lvl1
            KissButton:
                id: kiss_button_lvl1
                on_state: app.on_toggle_button_state(self, 1)
            #SpecialButton:
            #    id: special_button_lvl1
            #    on_state: app.on_special_button_state(self, 1)
        FloatLayout:
            #size_hint: 0, 0.9
            id: layout_lvl1
            on_touch_down: app.touch_down_handler(1, args)
            canvas.before:
                Rectangle:
                    size: self.size
                    pos: self.pos
                    source: "graphics/levels-bg/PvZ_day_bg_lvl1_cropped.jpg"
            Character:
                id: character_image_lvl1
                #pos: root.center_x-self.size[0]/2, root.center_y-self.size[1]/2
            PauseMenuWidget:
                id: pause_menu_lvl1



<Level2>:
    name: "level2"
    on_pre_enter: app.screen_on_pre_enter(2)
    #on_pre_leave: app.screen_on_pre_leave(2)
    on_enter: app.screen_on_enter(2)
    on_leave: app.screen_on_leave(2)
    BoxLayout:
        orientation: "horizontal"
        RelativeLayout:
            size_hint: app.side_bar_width, 1
            PauseButton:
                id: pause_button_lvl2
                on_press: app.pause_game(2)
            RemainingLifePercent
                id: remaining_life_percent_lvl2
            BoxLayout:
                size_hint: 1, 0.05
                pos_hint: {"x": 0.0, "y": .36}
                Label:
                    size_hint: 0.35, 1
                    canvas:
                        Rectangle:
                            pos: self.pos
                            size: self.size
                            source: "graphics/entities/star_small.png"
                NumCollectedStars:
                    id: num_stars_collected_lvl2
            KissButton:
                id: kiss_button_lvl2
                on_state: app.on_toggle_button_state(self, 2)
            SpecialButton:
                id: special_button_lvl2
                on_state: app.on_special_button_state(self, 2)
        FloatLayout:
            id: layout_lvl2
            on_touch_down: app.touch_down_handler(2, args)
            canvas.before:
                Rectangle:
                    size: self.size
                    pos: self.pos
                    source: "graphics/levels-bg/PvZ_day_bg_lvl1_cropped.jpg"
            Character:
                id: character_image_lvl2
                #pos: root.center_x-self.size[0]/2, root.center_y-self.size[1]/2
            PauseMenuWidget:
                id: pause_menu_lvl2

<Level3>:
    name: "level3"
    on_pre_enter: app.screen_on_pre_enter(3)
    #on_pre_leave: app.screen_on_pre_leave(3)
    on_enter: app.screen_on_enter(3)
    on_leave: app.screen_on_leave(3)
    BoxLayout:
        orientation: "horizontal"
        RelativeLayout:
            size_hint: app.side_bar_width, 1
            PauseButton:
                id: pause_button_lvl3
                on_press: app.pause_game(3)
            RemainingLifePercent
                id: remaining_life_percent_lvl3
            BoxLayout:
                size_hint: 1, 0.05
                pos_hint: {"x": 0.0, "y": .36}
                Label:
                    size_hint: 0.35, 1
                    canvas:
                        Rectangle:
                            pos: self.pos
                            size: self.size
                            source: "graphics/entities/star_small.png"
                NumCollectedStars:
                    id: num_stars_collected_lvl3
            KissButton:
                id: kiss_button_lvl3
                on_state: app.on_toggle_button_state(self, 3)
            SpecialButton:
                id: special_button_lvl3
                on_state: app.on_special_button_state(self, 3)
        FloatLayout:
            id: layout_lvl3
            on_touch_down: app.touch_down_handler(3, args)
            canvas.before:
                Rectangle:
                    size: self.size
                    pos: self.pos
                    source: "graphics/levels-bg/PvZ_day_bg_lvl1_cropped.jpg"
            Character:
                id: character_image_lvl3
                #pos: root.center_x-self.size[0]/2, root.center_y-self.size[1]/2
            PauseMenuWidget:
                id: pause_menu_lvl3

<Level4>:
    name: "level4"
    on_pre_enter: app.screen_on_pre_enter(4)
    #on_pre_leave: app.screen_on_pre_leave(4)
    on_enter: app.screen_on_enter(4)
    on_leave: app.screen_on_leave(4)
    BoxLayout:
        orientation: "horizontal"
        RelativeLayout:
            size_hint: app.side_bar_width, 1
            PauseButton:
                id: pause_button_lvl4
                on_press: app.pause_game(4)
            RemainingLifePercent
                id: remaining_life_percent_lvl4
            BoxLayout:
                size_hint: 1, 0.05
                pos_hint: {"x": 0.0, "y": .36}
                Label:
                    size_hint: 0.35, 1
                    canvas:
                        Rectangle:
                            pos: self.pos
                            size: self.size
                            source: "graphics/entities/star_small.png"
                NumCollectedStars:
                    id: num_stars_collected_lvl4
            KissButton:
                id: kiss_button_lvl4
                on_state: app.on_toggle_button_state(self, 4)
            SpecialButton:
                id: special_button_lvl4
                on_state: app.on_special_button_state(self, 4)
        FloatLayout:
            id: layout_lvl4
            on_touch_down: app.touch_down_handler(4, args)
            canvas.before:
                Rectangle:
                    size: self.size
                    pos: self.pos
                    source: "graphics/levels-bg/PvZ_day_bg_lvl1_cropped.jpg"
            Character:
                id: character_image_lvl4
                #pos: root.center_x-self.size[0]/2, root.center_y-self.size[1]/2
            PauseMenuWidget:
                id: pause_menu_lvl4

<Level5>:
    name: "level5"
    on_pre_enter: app.screen_on_pre_enter(5)
    #on_pre_leave: app.screen_on_pre_leave(5)
    on_enter: app.screen_on_enter(5)
    on_leave: app.screen_on_leave(5)
    BoxLayout:
        orientation: "horizontal"
        RelativeLayout:
            size_hint: app.side_bar_width, 1
            PauseButton:
                id: pause_button_lvl5
                on_press: app.pause_game(5)
            RemainingLifePercent
                id: remaining_life_percent_lvl5
            BoxLayout:
                size_hint: 1, 0.05
                pos_hint: {"x": 0.0, "y": .36}
                Label:
                    size_hint: 0.35, 1
                    canvas:
                        Rectangle:
                            pos: self.pos
                            size: self.size
                            source: "graphics/entities/star_small.png"
                NumCollectedStars:
                    id: num_stars_collected_lvl5
            KissButton:
                id: kiss_button_lvl5
                on_state: app.on_toggle_button_state(self, 5)
            SpecialButton:
                id: special_button_lvl5
                on_state: app.on_special_button_state(self, 5)
        FloatLayout:
            id: layout_lvl5
            on_touch_down: app.touch_down_handler(5, args)
            canvas.before:
                Rectangle:
                    size: self.size
                    pos: self.pos
                    source: "graphics/levels-bg/PvZ_day_bg_lvl1_cropped.jpg"
            Character:
                id: character_image_lvl5
                #pos: root.center_x-self.size[0]/2, root.center_y-self.size[1]/2
            PauseMenuWidget:
                id: pause_menu_lvl5


<NumCollectedStars@Label>:
    text: "0/0"
    font_size: 25
    #background_normal: ''
    #size_hint: (1, 0.15)
    #pos_hint: {'x': 0.0, 'y': 0.20}

<KissButton@ToggleButton>:
    size_hint: 1, 0.17
    #text: "Kiss"
    pos_hint: {'x': 0.0, 'y': 0.0}
    border: -8, -8, -8, -8
    background_normal: "graphics/entities/kiss1_bw.png"
    background_down: "graphics/entities/kiss1.png"

<SpecialButton@ToggleButton>:
    size_hint: 1, 0.17
    #text: "Diaper"
    pos_hint: {'x': 0.0, 'y': 0.18}
    border: 8, 8, 8, 8
    background_normal: "graphics/entities/diaper.png"
    background_down: "graphics/entities/diaper_orange.png"
    background_disabled_normal: "graphics/entities/diaper_bw.png"
    disabled: not app.special_button_enabled

<Character@Image>:
    #id: character_image
    size_hint: (0.07, 0.25)
    pos: self.parent.width/2-self.size[0]/2, self.parent.height/2-self.size[1]/2
    #pos_hint: {'center_x': app.character_center_x, 'center_y': app.character_center_y}
    source: "graphics/entities/Adelita_1.png"
    #im_num: 0
    allow_stretch: True
    keep_ratio: False
    #on_im_num: app.change_char_im(self)
    #on_pos_hint: app.char_pos_hint(self)
    #start_im_num: 0
    #end_im_num: 7
    mipmap: True

<RemainingLifePercent@Label>:
    remaining_life_size_hint_y: 0.3
    size_hint: (0.3, 0.3)
    pos_hint: {'x': 0.02, 'y': 0.42}
    #font_size: 20
    canvas:
        Color:
            rgb: (0, 0, 1)
        Rectangle:
            pos: self.pos
            size: self.size

<PauseButton@Button>:
    pos_hint: {'x': 0.05, 'y': 0.9}
    size_hint: (0.9, 0.1)
    background_color: 0, 0, 0, 0
    canvas:
        Rectangle:
            pos: self.pos
            size: self.size
            source: "graphics/pause_button.png"

<LevelButton@Button>:
    font_size: dp(20)
    font_name: 'graphics/fonts/pricedown bl.otf'
    size_hint: .15, .09
    background_color: 1, .3, .4, .85
    opacity: 1 if self.state == 'normal' else .5

<PauseMenuWidget>:
    #pos_hint: {'x': 0.0, 'y':0.}
    index: 0
    canvas.before:
        Color:
            rgba: 0, 0, 0, .8
        Rectangle:
            size: root.size
            pos: root.parent.width * app.side_bar_width, 0
    Button:
        font_size: dp(20)
        font_name: 'graphics/fonts/pricedown bl.otf'
        text: 'Continue'
        pos_hint: {"center_x": .5 + app.side_bar_width/2, "center_y": .7}
        size_hint: .2, .15
        background_normal: ''
        on_press: app.on_continue_button_pressed(root.parent.parent.parent)
        background_color: 1, .3, .4, .85
    Button:
        font_size: dp(20)
        font_name: 'graphics/fonts/pricedown bl.otf'
        text: 'Restart'
        pos_hint: {"center_x": .5 + app.side_bar_width/2, "center_y": .5}
        size_hint: .2, .15
        background_normal: ''
        on_press: app.on_restart_button_pressed(root.parent.parent.parent)
        background_color: 1, .3, .4, .85
    Button:
        font_size: dp(20)
        font_name: 'graphics/fonts/pricedown bl.otf'
        text: 'Main Menu'
        pos_hint: {"center_x": .5 + app.side_bar_width/2, "center_y": .3}
        size_hint: .2, .15
        background_normal: ''
        on_press:
            root.parent.parent.parent.manager.transition.direction = 'right'
            app.on_go_to_main_menu_button_pressed(root.parent.parent.parent)
        background_color: 1, .3, .4, .85